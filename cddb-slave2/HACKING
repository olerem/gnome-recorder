Hacking notes for cddb-slave2

* ChangeLog entries go in this directory until we merge all of them with
  the toplevel one

* CDDBSlave2 is the bonobo component that handles cddb-slave-client requests,
  and creates cddb-slave objects which connect to a server and do lookups.
  It lives for as long as a process still has a cddb-slave-client handle.
  cddb-slave-client handles are created with cddb_slave_client_new () and
  removed with g_object_unref ()
  (main.c)

* cddb-slave is the GObject created by the bonobo component that does the
  actual connecting to the CDDB server.
  (cddb-slave.c)

* cddb-slave-client is the library used by applications.
  The cddb-slave-client GObject is created using cddb_slave_client_new ().
  All requests for lookup are invoked through this object, which then
  calls the appropriate CORBA methods on the CDDBSlave2 component.
  For each slave-client that gets created, a slave object gets created in
  the CDDBSlave2 component.

DEBUGGING CDDB lookups
----------------------
* kill the CDDBSlave2 component
* set CDDB_SLAVE_DEBUG env var
* start up CDDBSlave2 from the command line

* cddb info is cached in $HOME/.cddbslave/ with files with the discid as
  name

cddb-slave2-query
-----------------
* a sample command-line application that can perform lookups given the
  cddb query string used in the protocol.

  arg 1 is the cd's discid
  arg 2 is the number of tracks (n)
  arg 3 .. 3 + n - 1 are the track start offsets
  arg 3 + n is the length of the disc in seconds
  
  Examples:


cddb-slave2-query 9b0ab70b 11 150 18628 34394 50839 69678 79616 99248 134880 151507 164754 189715 2745

returns

Looking up CDDBSlave2 entry with:
discid:           9b0ab70b
number of tracks: 11
offsets:          150 18628 34394 50839 69678 79616 99248 134880 151507 164754 189715
total seconds:    2745
 
Results of CDDBSlave2 lookup:
Artist:     Death Cab for Cutie
Disc Title: Transatlanticism
Tracks:     11
 
Track  1:   The New Year (4:5)
Track  2:   Lightness (3:29)
Track  3:   Title and Registration (3:38)
Track  4:   Expo '86 (4:10)
Track  5:   The Sound of Settling (2:11)
Track  6:   Tiny Vessels (4:20)
Track  7:   Transatlanticism (7:54)
Track  8:   Passenger Seat (3:40)
Track  9:   Death of an Interior Decorator (2:55)
Track 10:   We Looked Like Giants (5:31)
Track 11:   A Lack of Color (3:34)

cddb-slave2-query 56072d07 7 150 17640 29625 51380 70567 99705 122287 1839

is the query for the disc mentioned in
http://bugzilla.gnome.org/show_bug.cgi?id=78201

CDDB protocol
-------------

- http://www.freedb.org/modules.php?name=Sections&sop=viewarticle&artid=28
- UTF-8 is handled from protocol level 6 on.  You can set the server to
  a given protocol level by sending "proto 6" which will get a reply like

201 OK, CDDB protocol level now: 6

  if it worked and

501 Illegal CDDB protocol level.

  if it failed.

A sample session:

[thomas@urgent thomas]$ telnet freedb.freedb.org 888
Trying 193.201.200.74...
Connected to freedb.freedb.org.
Escape character is '^]'.
201 urchin CDDBP server v1.5PL2 ready at Tue May 11 09:47:19 2004
cddb hello unknown localhost telnet 0
200 Hello and welcome unknown@localhost running telnet 0.
cddb query 9b0ab70b 11 150 18628 34394 50839 69678 79616 99248 134880 151507 164754 189715 2745
200 rock 9b0ab70b Death Cab for Cutie / Transatlanticism
cddb read rock 9b0ab70b
210 rock 9b0ab70b CD database entry follows (until terminating `.')
# xmcd
#
# Track frame offsets:
#        150
#        18628
#        34394
#        50839
#        69678
#        79616
#        99248
#        134880
#        151507
#        164754
#        189715
#
# Disc length: 2745 seconds
#
# Revision: 5
# Processed by: cddbd v1.5PL2 Copyright (c) Steve Scherf et al.
# Submitted via: ExactAudioCopy v0.95a5
#
DISCID=9b0ab70b
DTITLE=Death Cab for Cutie / Transatlanticism
TTITLE0=The New Year
TTITLE1=Lightness
TTITLE2=Title And Registration
TTITLE3=Expo '86
TTITLE4=The Sound Of Settling
TTITLE5=Tiny Vessels
TTITLE6=Transatlanticism
TTITLE7=Passenger Seat
TTITLE8=Death of an Interior Decorator
TTITLE9=We Looked Like Giants
TTITLE10=A Lack Of Color
EXTD= YEAR: 2003
EXTT0=
EXTT1=
EXTT2=
EXTT3=
EXTT4=
EXTT5=
EXTT6=
EXTT7=
EXTT8=
EXTT9=
EXTT10=
PLAYORDER=
.
quit
230 urchin Closing connection.  Goodbye.
Connection closed by foreign host.


